#include "text.h"
#include "led.h"

static i32 text_length;
static char text_buffer[50];

static u8 FONT_BITMAP[(26 + 10) * 8];

void text_print(const char* text, const u32 length) {
    text_length = length;
    for (u32 i = 0; i < length; i++) {
        text_buffer[i] = text[i];
    }
}

void text_printi(i32 n) {
    text_length = 0;
    for (u32 val = n; val > 0 && text_length < 20; val /= 10, text_length++);

    for (u32 val = n, i = 0; val > 0; val /= 10, i++) {
        text_buffer[text_length - i - 1] = (val % 10) + 'Z' + 1;
    }
}

__attribute__((section(".ramtext")))
void text_rasterize(u8 *buffer, u16 y) {
    for (u32 i = 0; i < text_length; i++) {
        buffer[i] = FONT_BITMAP[(text_buffer[i] - 'A') * 8 + y];
    }
}

static u8 FONT_BITMAP[(26 + 10) * 8] = {
    // A
    0b00000000,
    0b00111100,
    0b01100110,
    0b01100110,
    0b01100110,
    0b01111110,
    0b01100110,
    0b01100110,

    // B
    0b00000000,
    0b01111100,
    0b01100110,
    0b01100110,
    0b01111100,
    0b01100110,
    0b01100110,
    0b01111100,

    // C
    0b00000000,
    0b00111100,
    0b01111110,
    0b01100110,
    0b01100000,
    0b01100110,
    0b01111110,
    0b00111100,

    // D
    0b00000000,
    0b01111100,
    0b01111110,
    0b01100110,
    0b01100110,
    0b01100110,
    0b01111110,
    0b01111100,

    // E
    0b00000000,
    0b01111110,
    0b01111110,
    0b01100000,
    0b01111000,
    0b01100000,
    0b01111110,
    0b01111110,

    // F
    0b00000000,
    0b01111110,
    0b01111110,
    0b01100000,
    0b01111000,
    0b01100000,
    0b01100000,
    0b01100000,

    // G
    0b00000000,
    0b00111110,
    0b01111110,
    0b01100000,
    0b01101110,
    0b01100110,
    0b01111110,
    0b00111100,

    // H
    0b00000000,
    0b01100110,
    0b01100110,
    0b01111110,
    0b01111110,
    0b01100110,
    0b01100110,
    0b01100110,

    // I
    0b00000000,
    0b01111110,
    0b01111110,
    0b00011000,
    0b00011000,
    0b00011000,
    0b01111110,
    0b01111110,


    // J
    0b00000000,
    0b00000110,
    0b00000110,
    0b00000110,
    0b00000110,
    0b01100110,
    0b01111110,
    0b00111100,

    // K
    0b00000000,
    0b01100110,
    0b01100110,
    0b01111100,
    0b01111000,
    0b01100110,
    0b01100110,
    0b01100110,

    // L
    0b00000000,
    0b01100000,
    0b01100000,
    0b01100000,
    0b01100000,
    0b01100000,
    0b01111110,
    0b01111110,

    // M
    0b00000000,
    0b01100110,
    0b01111110,
    0b01111110,
    0b01011010,
    0b01000010,
    0b01000010,
    0b01000010,

    // N
    0b00000000,
    0b01100110,
    0b01110110,
    0b01111110,
    0b01111110,
    0b01101110,
    0b01100110,
    0b01100110,

    // O
    0b00000000,
    0b00111100,
    0b01111110,
    0b01100110,
    0b01100110,
    0b01100110,
    0b01111110,
    0b00111100,

    // P
    0b00000000,
    0b01111100,
    0b01111110,
    0b01100110,
    0b01100110,
    0b01111110,
    0b01111100,
    0b01100000,

    // Q
    0b00000000,
    0b00111100,
    0b01111110,
    0b01100110,
    0b01100110,
    0b01100110,
    0b01111111,
    0b00111011,
    

    // R
    0b00000000,
    0b01111100,
    0b01111110,
    0b01100110,
    0b01100110,
    0b01111100,
    0b01100110,
    0b01100110,

    // S
    0b00000000,
    0b00111110,
    0b01111110,
    0b01100000,
    0b00111100,
    0b00000110,
    0b01111110,
    0b01111100,

    // T
    0b00000000,
    0b01111110,
    0b01111110,
    0b00011000,
    0b00011000,
    0b00011000,
    0b00011000,
    0b00011000,

    // U
    0b00000000,
    0b01100110,
    0b01100110,
    0b01100110,
    0b01100110,
    0b01100110,
    0b01111110,
    0b00111100,

    // V
    0b00000000,
    0b01100110,
    0b01100110,
    0b01100110,
    0b00111100,
    0b00111100,
    0b00011000,
    0b00011000,

    // W
    0b00000000,
    0b01000010,
    0b01000010,
    0b01000010,
    0b01011010,
    0b01111110,
    0b01111110,
    0b01100110,

    // X
    0b00000000,
    0b01100110,
    0b01100110,
    0b00111100,
    0b00011000,
    0b00111100,
    0b01100110,
    0b01100110,

    // Y
    0b00000000,
    0b01100110,
    0b01100110,
    0b00111100,
    0b00011000,
    0b00011000,
    0b00011000,
    0b00011000,

    // Z
    0b00000000,
    0b01111110,
    0b01111110,
    0b00001110,
    0b00111100,
    0b01110000,
    0b01111110,
    0b01111110,

    // 0
    0b00000000,
    0b00111100,
    0b01111110,
    0b01100110,
    0b01100110,
    0b01100110,
    0b01111110,
    0b00111100,

    // 1
    0b00000000,
    0b00011000,
    0b00111000,
    0b00111000,
    0b00011000,
    0b00011000,
    0b00111100,
    0b00111100,

    // 2
    0b00000000,
    0b00111100,
    0b01111110,
    0b01100110,
    0b00001100,
    0b00111000,
    0b01111110,
    0b01111110,

    // 3
    0b00000000,
    0b01111100,
    0b01111110,
    0b00000110,
    0b00011110,
    0b00000110,
    0b01111110,
    0b01111100,

    // 4
    0b00000000,
    0b01100110,
    0b01100110,
    0b01111110,
    0b01111110,
    0b00000110,
    0b00000110,
    0b00000110,

    // 5
    0b00000000,
    0b01111110,
    0b01111110,
    0b01100000,
    0b01111100,
    0b00000010,
    0b01111110,
    0b01111100,

    // 6
    0b00000000,
    0b00111110,
    0b01111110,
    0b01100000,
    0b01111100,
    0b01100110,
    0b01100110,
    0b00111100,

    // 7
    0b00000000,
    0b01111110,
    0b01111110,
    0b00000110,
    0b00001100,
    0b00011100,
    0b00011000,
    0b00011000,

    // 8
    0b00000000,
    0b00111100,
    0b01100110,
    0b01100110,
    0b00111100,
    0b01100110,
    0b01100110,
    0b00111100,

    // 9
    0b00000000,
    0b00111110,
    0b01111110,
    0b01100110,
    0b01100110,
    0b00111110,
    0b00000110,
    0b00000110,


};
